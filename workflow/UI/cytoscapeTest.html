<head>
    <script src="./cytoscape.min.js"></script>
    <script src="./data1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.core.js"></script>
    
</head>
<style>
        #cy {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0px;
            left: 0px;
        }
        .greydot { height: 25px; width: 25px; background-color: #bbb; border-radius: 50%; display: inline-block; }
        .greendot { height: 25px; width: 25px; background-color: green; border-radius: 50%; display: inline-block; }
        .reddot { height: 25px; width: 25px; background-color: red; border-radius: 50%; display: inline-block; }
</style>
<body>
    <div>
        <span class="greydot"></span><div>Unstarted</div> <br>
        <span class="greendot"></span><div>Succeeded1</div> <br>
        <span class="reddot"></span><div>Failed</div> <br>

    </div>

        <div id="cy">
                
        </div>
    <script>

        var graphData = []

        var colors = {

            "unstarted" : "grey",
            "succeeded" : "green",
            "failed" : "red"

        }

        var createDependents = (element) => {
            element.dependents.forEach(child => {
                    var childNode = _.find(graphData, {id:child});

                    if (!childNode) {
                        graphData.push({
                            data: {id: child }                            
                        })
                    }
                    
                    //create link to parent
                    graphData.push(
                        //create edge
                        {
                            data: {
                                id:element.name + "-" + child,
                                source:element.name,
                                target: child

                            }
                        }
                    )
                })
        }

        data.forEach(element => {
            //create node if needed

            var node = _.find(graphData, {data:{id:element.name}});
            if (!node) {

                node = {
                    data: {
                        id: element.name
                    },
                    style: {'background-color':colors[element.status]}
                }
                //create new node
                graphData.push(node);

                //create children if there is any
                createDependents(element)

            } else {
                //update status color
                node.style =  {'background-color':colors[element.status]}

                createDependents(element)
            }
        });

        



        var cy = cytoscape({
            container: document.getElementById('cy'),
            elements: graphData,

             layout: {
                name: 'breadthfirst',
                directed: true,
                rows: 1
            },

                style: [
                    {
                        
                        selector: 'node',
                        style: {
                            'label': 'data(id)',
                            shape: 'circle',
                            
                        }
                    }]      
            });


        cy.on('tap', 'node', function(evt){
                var node = evt.target;
                alert( 'tapped ' + node.id() );
                });

    </script>
    


</body>